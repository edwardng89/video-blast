<!-- app/views/public/rentals/show.html.erb -->
<div class="container py-4">

  <!-- HEADER -->
  <div class="d-flex justify-content-between align-items-start mb-4">
    <div>
      <h1 class="h4 mb-3">Movie Order</h1>

      <%# ---- Customer block ---- %>
      <% u = @rental.user %>
      <div class="fw-semibold"><%= [u&.first_name, u&.last_name].compact.join(" ").presence || u&.email %></div>
      <div class="text-muted">
        <% addr_parts = [
             u&.address_line_1,
             u&.address_line_2,
             [u&.suburb, u&.state].compact.join(" "),
             u&.postcode
           ].compact.reject(&:blank?) %>
        <% if addr_parts.any? %>
          <%= addr_parts.join("<br>").html_safe %>
        <% else %>
          <span class="fst-italic">No address on file</span>
        <% end %>
      </div>
    </div>

    <%# ---- Order meta ---- %>
    <div class="text-end">
      <div><strong>Order #:</strong> <%= @rental.order_number %></div>
      <div><strong>Status:</strong> <%= @rental.order_status %></div>
      <div>
        <strong>Order Date:</strong>
        <%= l((@rental.rental_date || @rental.created_at.to_date), format: :long) %>
      </div>
      <div>
        <strong>Return Date:</strong>
        <% due = @rental.due_date ||
                 (@rental.rental_date && @rental.rental_date + 7.days) ||
                 (@rental.created_at.to_date + 7.days) %>
        <%= l(due, format: :long) %>
      </div>
    </div>
  </div>

  <!-- LINE ITEMS -->
  <table class="table align-middle">
    <thead>
      <tr>
        <th>Movie</th>
        <th>Format</th>
        <th class="text-end">Qty</th>
        <th class="text-end">Price</th>
        <th class="text-end">Subtotal</th>
      </tr>
    </thead>
    <tbody>
      <% @items.each do |it| %>
        <tr>
          <td><%= it[:movie].title %></td>
          <td><%= it[:copy].copy_format %></td>
          <td class="text-end"><%= it[:quantity] %></td>
          <td class="text-end"><%= number_to_currency(it[:unit_price_cents] / 100.0) %></td>
          <td class="text-end"><%= number_to_currency(it[:subtotal_cents] / 100.0) %></td>
        </tr>
      <% end %>
    </tbody>
    <tfoot>
      <tr>
        <th colspan="4" class="text-end">Total</th>
        <th class="text-end"><%= number_to_currency(@total_cents / 100.0) %></th>
      </tr>
    </tfoot>
  </table>

  <div class="d-flex gap-2 mt-3">
    <%= link_to "Browse more", public_movies_path, class: "btn btn-secondary" %>
    <button class="btn btn-outline-primary" onclick="window.print()">Print</button>
  </div>
</div>
