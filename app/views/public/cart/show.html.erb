<%# app/views/public/cart/show.html.erb %>
<% if @items.blank? %>
  <p class="text-muted">Your cart is empty.</p>
  <%= link_to "Browse movies", public_movies_path, class: "btn btn-secondary" %>
<% else %>
  <%= form_with url: public_cart_path, method: :patch, local: true,
                html: { id: "cart-update-form" } do %>
    <table class="table align-middle">
      <thead>
        <tr>
          <th>Movie</th>
          <th class="text-center" style="width:110px;">Quantity</th>
          <th class="text-end">Price</th>
          <th class="text-end">Subtotal</th>
        </tr>
      </thead>
      <tbody>
        <% @items.each do |it| %>
          <tr>
            <td><%= it[:movie].title %> (<%= it[:copy].copy_format %>)</td>
            <td class="text-center">
              <%= number_field_tag "items[#{it[:copy].id}]", it[:quantity],
                    min: 0, class: "form-control text-center", style: "width: 90px" %>
            </td>
            <td class="text-end"><%= money_cents(it[:unit_price_cents]) %></td>
            <td class="text-end"><%= money_cents(it[:subtotal_cents]) %></td>
          </tr>
        <% end %>
      </tbody>
      <tfoot>
        <tr>
          <th colspan="3" class="text-end">Total</th>
          <th class="text-end"><%= money_cents(@total_cents) %></th>
        </tr>
      </tfoot>
    </table>
  <% end %>

  <!-- One line, three buttons; Update submits the form above via HTML "form" attr -->
  <div class="d-flex justify-content-end gap-2 mt-3">
    <button type="submit" form="cart-update-form" class="btn btn-primary">Update Cart</button>

    <%= button_to "Clear Cart",
                  clear_public_cart_path,
                  method: :delete,
                  form: { class: "d-inline" },
                  class: "btn btn-outline-danger" %>

    <%= button_to "Checkout",
                  public_rentals_path,
                  method: :post,
                  form: { class: "d-inline" },
                  class: "btn btn-success" %>
  </div>
<% end %>
