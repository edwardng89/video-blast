<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-7 col-lg-5">

      <!-- Profile card -->
      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body p-4 p-md-5">
          <h1 class="h4 mb-4">Edit profile</h1>

          <% if resource.errors.any? %>
            <div class="alert alert-danger small rounded-3">
              <strong><%= pluralize(resource.errors.count, "error") %>:</strong>
              <ul class="mb-0 mt-2">
                <% resource.errors.full_messages.each do |msg| %>
                  <li><%= msg %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <%= simple_form_for(resource, as: resource_name,
                url: registration_path(resource_name),
                html: { method: :put, class: "needs-validation", novalidate: true }) do |f| %>

            <div class="form-floating mb-3">
              <%= f.input_field :email, required: true, autofocus: true,
                                class: "form-control",
                                placeholder: "Email" %>
              <label for="<%= "#{resource_name}_email" %>">Email</label>
            </div>

            <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
              <p class="text-muted small mb-4">
                Currently waiting confirmation for: <strong><%= resource.unconfirmed_email %></strong>
              </p>
            <% end %>

            <div class="form-floating mb-3">
              <%= f.input_field :password, required: false,
                                autocomplete: "new-password",
                                class: "form-control",
                                placeholder: "New password" %>
              <label for="<%= "#{resource_name}_password" %>">New password</label>
            </div>
            <div class="form-text text-muted mb-3">
              Leave blank if you don’t want to change it.
            </div>

            <div class="form-floating mb-3">
              <%= f.input_field :password_confirmation, required: false,
                                autocomplete: "new-password",
                                class: "form-control",
                                placeholder: "Confirm new password" %>
              <label for="<%= "#{resource_name}_password_confirmation" %>">Confirm new password</label>
            </div>

            <div class="form-floating mb-2">
              <%= f.input_field :current_password, required: true,
                                autocomplete: "current-password",
                                class: "form-control",
                                placeholder: "Current password" %>
              <label for="<%= "#{resource_name}_current_password" %>">Current password</label>
            </div>
            <div class="form-text text-muted mb-4">
              We need your current password to confirm your changes.
            </div>

            <div class="d-grid">
              <%= f.button :submit, "Update", class: "btn btn-primary btn-lg rounded-3" %>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Danger zone -->
      <div class="card border-0 shadow-sm rounded-4 mt-4">
        <div class="card-body p-4">
          <h2 class="h5 text-danger mb-2">Danger zone</h2>
          <p class="text-muted mb-3">Delete your account and all associated data.</p>

          <div class="d-flex gap-2">
            <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
              Cancel account?
            </button>
            <%= link_to "Back", :back, class: "btn btn-light" %>
          </div>
        </div>
      </div>

      <!-- Confirm delete modal -->
      <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content rounded-4">
            <div class="modal-header">
              <h5 class="modal-title text-danger">Delete account?</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              This action is permanent. Are you sure you want to delete your account?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-light" data-bs-dismiss="modal">Keep my account</button>
              <%= button_to "Yes, delete it",
                    registration_path(resource_name),
                    method: :delete,
                    form: { data: { turbo_confirm: nil } },  # ensure Rails/UJS doesn’t stack another confirm
                    class: "btn btn-danger" %>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
